<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="custom view," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="封装自己的SearchView google在Android support v7包中提供了SearchView，开放的方法很少，导致SearchView自定义比较麻烦。但是SearchView往往是业务中常用的控件，其实实现也很简单，可以自己动手打造一个易扩展，可自定义的SearchView，来满足以后项目中的需求，下面就记录一下封装SearchView的详细过程。  最终效果gif:    这">
<meta name="keywords" content="custom view">
<meta property="og:type" content="article">
<meta property="og:title" content="封装自己的searchview">
<meta property="og:url" content="http://yoursite.com/2017/06/06/封装自己的searchview/index.html">
<meta property="og:site_name" content="JessieK&#39;s blog">
<meta property="og:description" content="封装自己的SearchView google在Android support v7包中提供了SearchView，开放的方法很少，导致SearchView自定义比较麻烦。但是SearchView往往是业务中常用的控件，其实实现也很简单，可以自己动手打造一个易扩展，可自定义的SearchView，来满足以后项目中的需求，下面就记录一下封装SearchView的详细过程。  最终效果gif:    这">
<meta property="og:image" content="http://oqujmbgen.bkt.clouddn.com/blog3.gif">
<meta property="og:image" content="http://oqujmbgen.bkt.clouddn.com/%E5%B0%81%E8%A3%85%E8%87%AA%E5%B7%B1%E7%9A%84searchview1.png">
<meta property="og:image" content="http://oqujmbgen.bkt.clouddn.com/%E5%B0%81%E8%A3%85%E8%87%AA%E5%B7%B1%E7%9A%84searchview2.png">
<meta property="og:image" content="http://oqujmbgen.bkt.clouddn.com/blog1.gif">
<meta property="og:image" content="http://oqujmbgen.bkt.clouddn.com/%E5%B0%81%E8%A3%85%E8%87%AA%E5%B7%B1%E7%9A%84searchview3.png">
<meta property="og:image" content="http://oqujmbgen.bkt.clouddn.com/blog2.gif">
<meta property="og:updated_time" content="2017-06-06T05:35:53.876Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="封装自己的searchview">
<meta name="twitter:description" content="封装自己的SearchView google在Android support v7包中提供了SearchView，开放的方法很少，导致SearchView自定义比较麻烦。但是SearchView往往是业务中常用的控件，其实实现也很简单，可以自己动手打造一个易扩展，可自定义的SearchView，来满足以后项目中的需求，下面就记录一下封装SearchView的详细过程。  最终效果gif:    这">
<meta name="twitter:image" content="http://oqujmbgen.bkt.clouddn.com/blog3.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/06/06/封装自己的searchview/"/>





  <title> 封装自己的searchview | JessieK's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JessieK's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/06/封装自己的searchview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jessie Kate">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JessieK's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                封装自己的searchview
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-06T13:20:09+08:00">
                2017-06-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/06/06/封装自己的searchview/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/06/06/封装自己的searchview/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="封装自己的SearchView"><a href="#封装自己的SearchView" class="headerlink" title="封装自己的SearchView"></a>封装自己的SearchView</h1><hr>
<p>google在Android support v7包中提供了SearchView，开放的方法很少，导致SearchView自定义比较麻烦。但是SearchView往往是业务中常用的控件，其实实现也很简单，可以自己动手打造一个易扩展，可自定义的SearchView，来满足以后项目中的需求，下面就记录一下封装SearchView的详细过程。</p>
<hr>
<p>最终效果gif:</p>
<ul>
<li><img src="http://oqujmbgen.bkt.clouddn.com/blog3.gif" alt="效果gif"></li>
</ul>
<p>这是封装好的lib库，上图<br><img src="http://oqujmbgen.bkt.clouddn.com/%E5%B0%81%E8%A3%85%E8%87%AA%E5%B7%B1%E7%9A%84searchview1.png" alt="封装好的lib库截图"><br>新建一个项目，具体过程不描述了，新建一个module，选择android libiary，填写好相关信息后finish。<br>继承LinearLayout实现View.OnKeyListener接口，这里主要是对实现软键盘搜索键的监听。</p>
<pre><code>@Override
 public void setOnKeyListener(OnKeyListener l) {
     et.setOnKeyListener(l);
 }
</code></pre><p>并向外暴露接口</p>
<pre><code>public interface searchEvent{
      void onSearch();
      void back();
  }
</code></pre><p>注册方法<br>       //实现搜索和返回接口<br>        public SearchView setSearchEvent(SearchView.searchEvent searchEvent) {<br>            this.searchEvent = searchEvent;<br>            return this;<br>        }</p>
<p>执行回调并隐藏软键盘</p>
<pre><code>@Override
public boolean onKey(View v, int keyCode, KeyEvent event) {
    if (event != null
            &amp;&amp; (keyCode == KeyEvent.KEYCODE_ENTER || keyCode == KeyEvent.KEYCODE_ENVELOPE)
            &amp;&amp; event.getRepeatCount() == 0
            &amp;&amp; event.getAction() == KeyEvent.ACTION_UP) {
        searchEvent.onSearch();
        InputMethodUtils.hideKeyBoard(et);
        return true;
    }
    return false;
}
</code></pre><p>首先我们要自定义searchview的布局，布局文件如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout android:id=&quot;@+id/lay_content_search&quot;
              xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
              android:layout_width=&quot;match_parent&quot;
              android:layout_height=&quot;50dp&quot;
              android:background=&quot;@color/default_blue&quot;
              android:orientation=&quot;horizontal&quot;
              android:gravity=&quot;center_vertical&quot;
              android:paddingBottom=&quot;5dp&quot;
              android:paddingTop=&quot;5dp&quot;&gt;

&lt;ImageView
    android:id=&quot;@+id/iv_back&quot;
    android:padding=&quot;10dp&quot;
    android:layout_marginLeft=&quot;4dp&quot;
    android:layout_width=&quot;30dp&quot;
    android:scaleType=&quot;centerCrop&quot;
    android:layout_height=&quot;match_parent&quot;
    android:layout_centerVertical=&quot;true&quot;
    android:src=&quot;@drawable/ic_title_back_white&quot;
    /&gt;

&lt;RelativeLayout
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;30dp&quot;
    android:layout_weight=&quot;1&quot;
    android:layout_marginLeft=&quot;10dp&quot;
    android:layout_marginRight=&quot;6dp&quot;
    android:background=&quot;@drawable/mask_round_rim_circle_gray&quot;&gt;

    &lt;ImageView
        android:id=&quot;@+id/iv_tag&quot;
        android:layout_width=&quot;20dp&quot;
        android:layout_height=&quot;20dp&quot;
        android:layout_alignParentLeft=&quot;true&quot;
        android:layout_centerVertical=&quot;true&quot;
        android:layout_marginLeft=&quot;8dp&quot;
        android:scaleType=&quot;centerCrop&quot;
        android:src=&quot;@drawable/ic_content_search&quot;/&gt;

    &lt;AutoCompleteTextView
        android:id=&quot;@+id/et_content_search&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;
        android:layout_centerHorizontal=&quot;true&quot;
        android:layout_centerVertical=&quot;true&quot;
        android:layout_marginLeft=&quot;5dp&quot;
        android:layout_toRightOf=&quot;@+id/iv_tag&quot;
        android:background=&quot;@null&quot;
        android:ems=&quot;10&quot;
        android:hint=&quot;@string/hint_input_search&quot;
        android:imeOptions=&quot;actionSearch&quot;
        android:textCursorDrawable=&quot;@drawable/cursor_blue&quot;
        android:inputType=&quot;text&quot;
        android:maxLines=&quot;1&quot;
        android:textColor=&quot;@color/default_blue&quot;
        android:textColorHint=&quot;@color/default_et_hint&quot;
        android:textSize=&quot;13sp&quot;&gt;

        &lt;requestFocus/&gt;
    &lt;/AutoCompleteTextView&gt;

    &lt;ImageView
        android:id=&quot;@+id/iv_del_content&quot;
        android:layout_width=&quot;30dp&quot;
        android:layout_height=&quot;match_parent&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:layout_centerVertical=&quot;true&quot;
        android:scaleType=&quot;centerCrop&quot;
        android:src=&quot;@drawable/sl_del_content&quot;
        android:visibility=&quot;gone&quot;
        /&gt;

&lt;/RelativeLayout&gt;

&lt;Button
    android:id=&quot;@+id/btn_content_search&quot;
    android:layout_width=&quot;60dp&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:background=&quot;@null&quot;
    android:text=&quot;@string/text_search&quot;
    android:textSize=&quot;14sp&quot;
    android:textColor=&quot;@color/white&quot;
    /&gt;
</code></pre><p><br>效果如图：<br><img src="http://oqujmbgen.bkt.clouddn.com/%E5%B0%81%E8%A3%85%E8%87%AA%E5%B7%B1%E7%9A%84searchview2.png" alt="布局效果图"><br>这里的输入框用的是AutoCompleteTextView，它是继承EditTextView的，可以实现搜索文字补全的功能， android:imeOptions=”actionSearch”这句是把软键盘上的回车键改为搜索。<br>接着我们可以通过一些方法对ui和搜索间隔时长进行自定义：</p>
<pre><code>//设置间隔时间
public SearchView setIntervalTime(int intervalTime){
    this.intervalTime=intervalTime;
    return this;
}

//设置背景颜色
public SearchView setBackGroundColor(int color){
    layContentSearch.setBackgroundColor(color);
    return this;
}

//设置返回按钮
public SearchView setBackIcon(int resId){
    iback.setImageResource(resId);
    return this;
}

//设置搜索图标
public SearchView setTagIcon(int resId){
    ivTag.setImageResource(resId);
    return this;
}

//设置删除图标
public SearchView setDelIcon(int resId){
    ib.setImageResource(resId);
    return this;
}

//设置搜索文本
public SearchView setSearchText(String text){
    search.setText(text);
    return this;
}

//设置搜索文本颜色
public SearchView setSearchTextColor(int color){
    search.setTextColor(color);
    return this;
}

//设置搜索文本背景图片
public SearchView setSearchBackground(int resId){
    search.setBackgroundResource(resId);
    return this;
}

//设置搜索文本背景颜色
public SearchView setSearchBackgroundColor(int color){
    search.setBackgroundColor(color);
    return this;
}

//设置搜索框提示文本
public SearchView setSearchHintText(String hintText){
    search.setHint(hintText);
    return this;
}

//设置搜索框提示文本颜色
public SearchView setSearchHintTextColor(int color){
    search.setHintTextColor(color);
    return this;
}
</code></pre><p>为了方便我们在xml中直接进行自定义，可以新建一些自定义的属性：</p>
<pre><code>  &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources&gt;

    &lt;!--searchview属性自定义--&gt;
    &lt;declare-styleable name=&quot;SearchView&quot;&gt;
        &lt;attr name=&quot;intervalTime&quot; format=&quot;integer&quot;/&gt;
        &lt;attr name=&quot;backgroundColor&quot; format=&quot;color&quot;/&gt;
        &lt;attr name=&quot;backIcon&quot; format=&quot;reference&quot;/&gt;
        &lt;attr name=&quot;tagIcon&quot; format=&quot;reference&quot;/&gt;
        &lt;attr name=&quot;delIcon&quot; format=&quot;reference&quot;/&gt;
        &lt;attr name=&quot;searchText&quot; format=&quot;string&quot;/&gt;
        &lt;attr name=&quot;searchTextColor&quot; format=&quot;color&quot;/&gt;
        &lt;attr name=&quot;searchBackground&quot; format=&quot;reference&quot;/&gt;
        &lt;attr name=&quot;searchBackgroundColor&quot; format=&quot;color&quot;/&gt;
        &lt;attr name=&quot;searchHintText&quot; format=&quot;string&quot;/&gt;
        &lt;attr name=&quot;searchHintTextColor&quot; format=&quot;color&quot;/&gt;

    &lt;/declare-styleable&gt;

&lt;/resources&gt;
</code></pre><p>在searchview初始化时，载入布局，初始化子view，读取自定义属性：</p>
<pre><code> public SearchView(Context context, AttributeSet attrs) {
    super(context, attrs);
    LayoutInflater.from(context).inflate(R.layout.widget_search_et_btn, this, true);
    TypedArray a = context.obtainStyledAttributes(attrs,
            R.styleable.SearchView);
    initView();
    intervalTime=a.getInt(R.styleable.SearchView_intervalTime,1000);
    setBackGroundColor(a.getColor(R.styleable.SearchView_backgroundColor,getResources().getColor(R.color.default_blue)));
    setBackIcon(a.getResourceId(R.styleable.SearchView_backIcon,R.drawable.ic_title_back_white));
    setTagIcon(a.getResourceId(R.styleable.SearchView_tagIcon,R.drawable.ic_content_search));
    setDelIcon(a.getResourceId(R.styleable.SearchView_delIcon,R.drawable.sl_del_content));
    setSearchText(a.getString(R.styleable.SearchView_searchText));
    setSearchTextColor(a.getColor(R.styleable.SearchView_searchTextColor,getResources().getColor(R.color.white)));
    setSearchBackground(a.getResourceId(R.styleable.SearchView_searchBackground,android.R.color.transparent));
    setSearchBackgroundColor(a.getColor(R.styleable.SearchView_searchBackgroundColor,getResources().getColor(android.R.color.transparent)));
    setSearchHintText(a.getString(R.styleable.SearchView_searchHintText));
    setSearchHintTextColor(a.getColor(R.styleable.SearchView_searchHintTextColor,getResources().getColor(R.color.default_line)));

}
</code></pre><p>  <img src="http://oqujmbgen.bkt.clouddn.com/blog1.gif" alt="删除按钮效果"><br>  关于删除按钮，我们需要监听文本框的文字变化和点击事件，而且当输入的搜索文字变化时，希望像大多数app一样，有个实时显示搜索结果的效果，但是当输入变化很快时，搜索次数太多可能造成一定的性能下降，我们可以设定一个间隔时间，间隔时间内，不用进行再次搜索：</p>
<pre><code>  // 当输入框状态改变时，会调用相应的方法
TextWatcher tw = new TextWatcher() {

    @Override
    public void onTextChanged(CharSequence s, int start, int before, int count) {
    }

    @Override
    public void beforeTextChanged(CharSequence s, int start, int count, int after) {
    }

    // 在文字改变后调用
    @Override
    public void afterTextChanged(Editable s) {
        if (s.length() == 0) {
            hideBtn();// 隐藏按钮
        } else {
            showBtn();// 显示按钮
        }


        //输入文字变化时,超过间隔时间才搜索
        if(System.currentTimeMillis()-lastTime&gt;intervalTime){
            searchEvent.onSearch();
        }

        lastTime= System.currentTimeMillis();
    }
};

// 设置按钮不可见
private void hideBtn() {

    if (ib.isShown())
        ib.setVisibility(View.GONE);
}

// 设置按钮可见
private void showBtn() {
    if (!ib.isShown())
        ib.setVisibility(View.VISIBLE);
}

 // 添加按钮点击事件
 ib.setOnClickListener(new OnClickListener() {
        @Override
        public void onClick(View v) {
            hideBtn();// 隐藏按钮
            et.setText(&quot;&quot;);// 设置输入框内容为空
        }
    });
</code></pre><p>关于搜索文字补全，这里是给AutoCompleteTextView添加了一个适配器，需要继承BaseAdapter，并实现Filterable接口，具体实现如下：</p>
<pre><code>public class AutoComplateSearchAdapter extends BaseAdapter implements Filterable {
private ArrayFilter mFilter;
private ArrayList&lt;String&gt; keyList;//数据源列表
private Context context;
private ArrayList&lt;String&gt; mUnfilteredData;//待过滤数据集合

public AutoComplateSearchAdapter(Context context,ArrayList&lt;String&gt; keyList) {
    this.context = context;
    this.keyList = keyList;
}

@Override
public int getCount() {
    return keyList.size();
}

@Override
public Object getItem(int position) {
    return keyList.get(position);
}

@Override
public long getItemId(int position) {
    return position;
}

@Override
public View getView(int position, View convertView, ViewGroup parent) {
    View view;
    ViewHolder holder;
    if (convertView == null) {
        view = View.inflate(context, R.layout.adapter_auto, null);

        holder = new ViewHolder();
        holder.tv_name = (TextView) view.findViewById(R.id.item_auto_txt);
        holder.lineTop = (ImageView) view.findViewById(R.id.item_auto_line_top);
        holder.lineBottom = (ImageView) view.findViewById(R.id.item_auto_line_bottom);
        view.setTag(holder);
    } else {
        view = convertView;
        holder = (ViewHolder) view.getTag();
    }

    String key = keyList.get(position);
    holder.tv_name.setText(key);
    return view;
}

static class ViewHolder {
    public TextView tv_name;
    public ImageView lineTop;
    public ImageView lineBottom;
}

@Override
public Filter getFilter() {
    if (mFilter == null) {
        mFilter = new ArrayFilter();
    }
    return mFilter;
}

private final Object mLock = new Object();

private class ArrayFilter extends Filter {

    @Override
    protected FilterResults performFiltering(CharSequence prefix) {
        FilterResults results = new FilterResults();

        if (mUnfilteredData == null) {
            synchronized (mLock) {
                mUnfilteredData = new ArrayList&lt;String&gt;(keyList);
            }
        }
        if (prefix == null || prefix.length() == 0) {
            results.values = mUnfilteredData;
            results.count = mUnfilteredData.size();
        } else {
            String prefixString = prefix.toString().toLowerCase();
            ArrayList&lt;String&gt; newValues = new ArrayList&lt;String&gt;(mUnfilteredData.size());
            for (int i = 0; i &lt; mUnfilteredData.size(); i++) {
                String str = mUnfilteredData.get(i);
                if (!TextUtils.isEmpty(str) &amp;&amp; !TextUtils.isEmpty(prefixString) &amp;&amp; str.contains(prefixString)) {
                    newValues.add(str);
                }
            }
            results.values = newValues;
            results.count = newValues.size();
        }

        return results;
    }

    @Override
    protected void publishResults(CharSequence constraint,
                                  FilterResults results) {
        //noinspection unchecked
        keyList = (ArrayList&lt;String&gt;) results.values;
        if (results.count &gt; 0) {
            notifyDataSetChanged();
        } else {
            notifyDataSetInvalidated();
        }
    }
}
</code></pre><p>}  </p>
<p>自动补全列表的布局也很简单，相当于list的item：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
              android:layout_width=&quot;match_parent&quot;
              android:layout_height=&quot;35dp&quot;
              android:background=&quot;@color/white&quot;
    &gt;

&lt;ImageView
    android:id=&quot;@+id/item_auto_line_top&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;2px&quot;
    android:layout_alignParentTop=&quot;true&quot;
    android:background=&quot;#6c01b5c6&quot;/&gt;

&lt;TextView
    android:id=&quot;@+id/item_auto_txt&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:layout_marginLeft=&quot;15dp&quot;
    android:layout_centerVertical=&quot;true&quot;
    android:text=&quot;cnsio&quot;
    android:textColor=&quot;@color/default_blue&quot;
    android:textSize=&quot;14sp&quot;
    /&gt;

&lt;ImageView
    android:id=&quot;@+id/item_auto_line_bottom&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;2px&quot;
    android:layout_alignParentBottom=&quot;true&quot;
    android:background=&quot;#6c01b5c6&quot;/&gt;
&lt;/RelativeLayout&gt;
</code></pre><p><img src="http://oqujmbgen.bkt.clouddn.com/%E5%B0%81%E8%A3%85%E8%87%AA%E5%B7%B1%E7%9A%84searchview3.png" alt="搜索文字自动补全效果图"><br>接下来是数据展示，用的是RecyclerView，这里也做了封装：<br>  新建了一个抽象类SearchActivity继承AppCompatActivity，将RecyclerView封装到fragment并暴露一些数据源，RecyclerView，SearchView的设置方法。</p>
<pre><code>protected SearchView searchView;
protected ResultFragment resultFragment;

//search to do 搜索逻辑
protected abstract void doSearch();
//set result list adapter 设置结果列表适配器
protected abstract RecyclerView.Adapter setResultListAdapter();

//return search content input
protected String getSearchContent(){
    return searchView.getText().toString().trim();
}

//bind searchview 绑定searchview
protected void findSearchView(int searchViewId) {
    searchView = (SearchView) this.findViewById(searchViewId);
    searchView.setSearchEvent(new SearchView.searchEvent() {
        @Override
        public void onSearch() {
            doSearch();
        }

        @Override
        public void back() {
            finish();
        }

    });
}

//set search keylist Completion adapter 设置自动补全搜索关键字适配器
protected void setKeyListAdapter (ArrayList&lt;String&gt; keyList){
    searchView.setKeyListAdapter(keyList);
}

//set result list divider 设置结果列表分割线,可重写
protected RecyclerView.ItemDecoration setResultListDivider(){
    return new RecycleViewDivider(this, LinearLayoutManager.HORIZONTAL, 10, getResources().getColor(R.color.bg));
}

//set result list LayoutManager 设置RecyclerView的布局管理器
protected RecyclerView.LayoutManager setLayoutManager(){
    return new LinearLayoutManager(this);
}

//init result fragment 初始化结果分页
protected void initResultFragment(int SearchFragmentId) {
    resultFragment = new ResultFragment();
    FragmentTransaction transaction = getSupportFragmentManager().beginTransaction();

//        Bundle bundle = new Bundle();
//        fragment.setArguments(bundle);

    transaction.replace(SearchFragmentId, resultFragment);
    transaction.commit();
}
</code></pre><p>  <img src="http://oqujmbgen.bkt.clouddn.com/blog2.gif" alt="此处输入图片的描述"><br>  接下来是实现点击其它区域，隐藏软键盘并清除输入框焦点：</p>
<pre><code> //清除焦点
private void clearViewFocus(View v, View... views) {
    if (null != v &amp;&amp; null != views &amp;&amp; views.length &gt; 0) {
        for (View view : views) {
            if (v.getId() == view.getId()) {
                v.setEnabled(false);
                break;
            }
        }
    }
}

//得到焦点
private void getViewFocus(View v, View... views) {
    if (null != v &amp;&amp; null != views &amp;&amp; views.length &gt; 0) {
        for (View view : views) {
            if (v.getId() == view.getId()) {
                v.setEnabled(true);
                break;
            }
        }
    }
}


//view是否得到焦点
private boolean isFocusEditText(View v, View... views) {
    if (v instanceof EditText) {
        EditText tmp_et = (EditText) v;
        for (View view : views) {
            if (tmp_et.getId() == view.getId()) {
                return true;
            }
        }
    }
    return false;
}


//是否触摸在指定view上面
private boolean isTouchView(View[] views, MotionEvent ev) {
    if (views == null || views.length == 0) return false;
    int[] location = new int[2];
    for (View view : views) {
        view.getLocationOnScreen(location);
        int x = location[0];
        int y = location[1];
        if (ev.getX() &gt; x &amp;&amp; ev.getX() &lt; (x + view.getWidth())
                &amp;&amp; ev.getY() &gt; y &amp;&amp; ev.getY() &lt; (y + view.getHeight())) {
            return true;
        }
    }
    return false;
}

   //隐藏键盘逻辑
    @Override
    public boolean dispatchTouchEvent(MotionEvent ev) {
        if (ev.getAction() == MotionEvent.ACTION_DOWN) {
            View v = getCurrentFocus();            //得到当前activity的焦点view
            if (isTouchView(filterViewByIds(), ev)) //触摸到不隐藏键盘的view不做处理
                return super.dispatchTouchEvent(ev);
            if(isTouchView(hideSoftByEditViewIds(), ev)){//触摸到隐藏键盘的view不做处理
                getViewFocus(v,hideSoftByEditViewIds());
                return super.dispatchTouchEvent(ev);
            }
            //触摸到其它view
            if (hideSoftByEditViewIds() == null || hideSoftByEditViewIds().length == 0)
                return super.dispatchTouchEvent(ev);
            // view得到了焦点
            if (isFocusEditText(v, hideSoftByEditViewIds())) {
                //清除隐藏键盘的view焦点
                clearViewFocus(v, hideSoftByEditViewIds());
                //隐藏键盘
                InputMethodUtils.hideKeyBoard(this);
            }
        }
        return super.dispatchTouchEvent(ev);

    }

//传入Id,触摸到其它view时，隐藏此view对应的软键盘
protected View[] hideSoftByEditViewIds() {
    View[] views = {searchView.getEditView()};
    return views;
}


//传入要过滤的View,过滤之后将不会隐藏软键盘
protected View[] filterViewByIds() {
    return null;
}
</code></pre><p>最后说明一下使用方法，在使用lib库时，需要让搜索界面的activity继承SearchActivity，实现其中的抽象方法：</p>
<pre><code> //搜索逻辑
protected void doSearch() {
    resultListAdapter.setData(search(getSearchContent()));
}

@Override
protected RecyclerView.Adapter setResultListAdapter() {
    //bind data 绑定数据和适配器
    resultListAdapter=new ResultListAdapter();
    resultListAdapter.setData(newsDTOs);
    return resultListAdapter;
}
</code></pre><p>结果列表RecyclerView的Adapter的实现就不赘述了，根据展示的需求自定义，RecyclerView的布局管理器，分割线，隐藏软件盘的view过滤，需要隐藏软键盘的view设置都是可以重写SearchActivity中对应的方法进行自定义。</p>
<p>搜索界面的activity，初始化时需要绑定searchview的id和fragment的容器id</p>
<pre><code>//初始化结果分页
initResultFragment(R.id.ll_content);
//绑定searchview
findSearchView(R.id.sc_content);
</code></pre><p>可以设置searchview自动补全的数据源，自定义ui</p>
<pre><code>//设置搜索关键字自动补全
setKeyListAdapter(setKeyList());
setSearchView();

//custom searchview ui 自定义searchview的外观
public void setSearchView(){
    searchView.setIntervalTime(1000)
              .setBackGroundColor(getResources().getColor(R.color.default_blue))
              .setBackIcon(R.drawable.ic_title_back_white)
              .setTagIcon(R.drawable.ic_content_search)
              .setDelIcon(R.drawable.sl_del_content)
              .setSearchText(getString(R.string.text_search))
              .setSearchTextColor(getResources().getColor(R.color.white))
              .setSearchBackground(getResources().getColor(android.R.color.transparent))
              .setSearchBackgroundColor(getResources().getColor(android.R.color.transparent))
              .setSearchHintText(getString(R.string.hint_input_search))
              .setSearchHintTextColor(getResources().getColor(R.color.default_line));
}
</code></pre><p>在xml中直接自定义ui</p>
<pre><code>&lt;searchview.jessie.com.searchviewlib.SearchView
android:id=&quot;@+id/sc_content&quot;
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;wrap_content&quot;
jessie:intervalTime=&quot;2000&quot;
jessie:backIcon=&quot;@drawable/ic_title_back_white&quot;
jessie:backgroundColor=&quot;@color/default_blue&quot;
jessie:tagIcon=&quot;@drawable/ic_content_search&quot;
jessie:delIcon=&quot;@drawable/sl_del_content&quot;
jessie:searchText=&quot;@string/text_search&quot;
jessie:searchTextColor=&quot;@color/white&quot;
jessie:searchHintText=&quot;@string/hint_input_search&quot;/&gt;
</code></pre><p>到此，封装自己的searchview就完成了，需要查看完整代码，这里是<a href="https://github.com/jessieeeee/SearchView" target="_blank" rel="external">传送门</a>。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/custom-view/" rel="tag"># custom view</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/06/01/我的第一篇文章/" rel="next" title="我的第一篇文章">
                <i class="fa fa-chevron-left"></i> 我的第一篇文章
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Jessie Kate" />
          <p class="site-author-name" itemprop="name">Jessie Kate</p>
           
              <p class="site-description motion-element" itemprop="description">程序的世界，比你牛逼的人更比你努力。<br /> ——爱编码，爱运动，爱游戏，<br />喜欢关注科技资讯的女coder</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#封装自己的SearchView"><span class="nav-number">1.</span> <span class="nav-text">封装自己的SearchView</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jessie Kate</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/three/three.min.js"></script>

  
  <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://JessieK.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2017/06/06/封装自己的searchview/';
          this.page.identifier = '2017/06/06/封装自己的searchview/';
          this.page.title = '封装自己的searchview';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://JessieK.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  





  






  





  

  

  

  

</body>
</html>
